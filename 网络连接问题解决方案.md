# 网络连接问题解决方案

## 问题诊断

根据控制台输出：
- ✅ API Key已正确加载
- ✅ 请求地址正确
- ❌ 连接被关闭：`net::ERR_CONNECTION_CLOSED`

## 最可能的原因：CORS限制

**backgrace.com可能不支持浏览器直接访问**，只允许服务器端调用。

这是一个架构问题：
- 浏览器 → API服务器 ❌（CORS阻止）
- 后端服务器 → API服务器 ✅（允许）

## 解决方案

### 方案1：使用代理服务器（推荐）

创建一个简单的Node.js后端代理：

**1. 创建proxy服务器**
```javascript
// proxy-server.js
const express = require('express');
const fetch = require('node-fetch');
const cors = require('cors');
const fs = require('fs');

const app = express();
app.use(cors());
app.use(express.json({ limit: '50mb' }));

const API_KEY = fs.readFileSync('apikey.txt', 'utf8').trim();
const BASE_URL = 'https://backgrace.com';

app.post('/api/claude', async (req, res) => {
  try {
    const response = await fetch(`${BASE_URL}/v1/messages`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': API_KEY,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify(req.body)
    });

    const data = await response.json();
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(8080, () => {
  console.log('Proxy server running on http://localhost:8080');
});
```

**2. 安装依赖**
```bash
npm install express node-fetch cors
```

**3. 运行代理**
```bash
node proxy-server.js
```

**4. 修改前端配置**
将`baseUrl`从`https://backgrace.com`改为`http://localhost:8080/api/claude`

### 方案2：使用Vite代理（更简单）

修改`vite.config.ts`：
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      '/api': {
        target: 'https://backgrace.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

然后修改前端代码，将请求发送到`/api/v1/messages`而不是`https://backgrace.com/v1/messages`。

### 方案3：检查API服务商文档

联系backgrace.com确认：
1. 是否支持浏览器直接访问？
2. 是否需要特殊的CORS配置？
3. 是否有专门的前端SDK？

### 方案4：临时测试 - 禁用浏览器安全（不推荐生产环境）

仅用于测试：
```bash
# Chrome（Windows）
chrome.exe --disable-web-security --user-data-dir="C:\tmp\chrome_dev"

# Chrome（Mac）
open -na Google\ Chrome --args --disable-web-security --user-data-dir=/tmp/chrome_dev
```

## 推荐方案

**我强烈推荐使用方案2（Vite代理）**，因为：
1. 最简单，只需修改配置文件
2. 开发环境友好
3. 不需要额外的服务器

## 下一步

您想使用哪个方案？我可以帮您实施。

或者，如果您确认backgrace.com支持浏览器访问，我们需要进一步调试网络问题。
